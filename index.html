<html>

<head>
    <title>Rock Paper Scissors Challenge</title>
    <script src="/socket.io/socket.io.js">
    </script>
    <script>
    var choice = function(data) {
        socket.emit('choice', data);
    };

    var toggle = function(id, toggle) {
        var element = document.getElementById(id);
        element.style.visibility = toggle;
    };

    var setText = function(id, text) {
        var element = document.getElementById(id);
        element.innerHTML = text;
    };
    var appendText = function(id, text) {
        var element = document.getElementById(id);
        element.innerHTML = element.innerHTML + "</br>" + text;
    };
    var socket = io.connect('http://localhost', {
        'sync disconnect on unload': true
    });
    socket.on('playerid', function(data) {
        console.log(data);
        var line = "Your player id is: " + data.content;
        appendText('debug', line);
        socket.emit('ready', 'ready');
    });

    socket.on('wait', function(data) {
        console.log(data);
        toggle('wait', 'visible');
        setText('wait', data.content);
        toggle('game', 'hidden');
    });

    socket.on('choose', function() {
        setText('result', '');
        toggle('result', 'hidden');
        setText('counter', '');
        toggle('counter', 'hidden');
        toggle('game', 'visible');
        // var game = document.getElementById('game');
        // game.style.visibility = "visible";
        toggle('wait', 'hidden');
        // var wait = document.getElementById('wait');
        // wait.style.visibility = "hidden";
    });

    socket.on('stats', function(data){
        console.log(data);
        var line = 'WON: ' + data.w + ' LOST: ' + data.l + ' STREAK: ' + data.ws;
        setText('stats',line);
    });

    socket.on('result', function(data) {
        // toggle('game', 'hidden');
        setText('result', data.content);
        toggle('result', 'visible');
        var secs = 1;

        updateText();

        function updateText() {
                // var counter = document.getElementById('counter');
                var line = 'You will be placed in queue after ' + secs + ' seconds';
                toggle('counter', 'visible');
                setText('counter', line);
                secs--;
                if (secs > 0) {
                    setTimeout(updateText, 100);
                }
            }
            // counter.style.visibility = 'hidden';
    });
    </script>
    <link rel="stylesheet" type="type/css" href="/style.css" />
</head>

<body>
    <div class="main">
        <div id='stats'></div>
        <span id='wait'></span>
        </br>
        <div id='game' style="visibility:hidden">
            <span class="choice">
            <a onClick="choice('rock')">
                <img src="rock.png" />
            </a>
        </span>
        <span>
            <a onClick="choice('paper')">
                <img src="paper.png" />
            </a>
        </span>
        <span>
            <a onClick="choice('scissors')">
                <img src="scissors.png" />
            </a>
        </span>
        </div>
        </br>
        <span id='result' style="visibility:hidden">
        </span>
        </br>
        <span id='counter'>
        </span>
        <span id='debug' style="visibility:hidden">
        </span>
    </div>
</body>

</html>
